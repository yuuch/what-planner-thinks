# 那个叫 Planner 的家伙在想什么？

## 简介

> **[在线阅读](https://yuuch.github.io/what-planner-thinks/)**
>
> **代码版本声明**：本笔记内容主要基于 PostgreSQL **REL_18_1** (Development version) 源码进行深度解析。

本书旨在深入解析 PostgreSQL 查询优化器（Query Optimizer）的内部工作原理。PostgreSQL 的优化器是数据库内核中最复杂、最核心的组件之一，负责将 SQL 查询转换为高效的执行计划。

## 目标读者

*   数据库内核开发者
*   PostgreSQL DBA 和高级用户
*   对数据库内部原理感兴趣的学生和研究人员

## 内容概览

本书按照优化器的执行流程和核心组件进行组织：

1.  **逻辑重写与扁平化**：介绍查询树（Query Tree）在进入代价模型之前的预处理步骤，包括子查询提升、外连接消除等逻辑优化。
2.  **基础设施 (The Core)**：详细讲解支撑优化器的核心数据结构和算法，如等价类、PathKeys、统计信息与代价估算。
3.  **路径搜索 (Scan & Join)**：探讨如何生成单表访问路径以及多表连接路径，包括动态规划算法和遗传算法。
4.  **后置处理**：涵盖连接路径生成之后的步骤，如分组聚合、排序、LockRows 以及并行计划的生成。
5.  **源码深度拆解**：结合源码（主要基于 PostgreSQL REL_18_1），分析关键函数和数据结构。

## 学习建议

建议配合 PostgreSQL 源码阅读本书。优化器的代码主要位于 `src/backend/optimizer` 目录下。
